---
title: í˜ë¥´ì†Œë‚˜ RAG ì‹œìŠ¤í…œ ìƒì„¸
---
flowchart TB
    subgraph Input["ğŸ“¥ ì…ë ¥"]
        Topic[ì£¼ì œ<br/>ì •ê·œí™”ëœ í† í”½]
        ChannelId[ì±„ë„ ID]
    end

    subgraph PersonaConfig["ğŸ­ í˜ë¥´ì†Œë‚˜ Config"]
        Identity[ì •ì²´ì„±<br/>ì´ë¦„, ì†Œê°œ, ì „ë¬¸ë¶„ì•¼]
        Voice[ìŒì„± ì„¤ì •<br/>ì„±ë³„, TTS ID, ì†ë„]
        Communication[ì»¤ë®¤ë‹ˆì¼€ì´ì…˜<br/>í†¤, ë§íˆ¬, ê¸ˆì§€ì–´]
        Perspective[ê´€ì <br/>ê°€ì¹˜ê´€, í¸í–¥, ë°˜ì£¼ë¥˜]
        Examples[ì˜ˆì‹œ<br/>ì¢‹ì€/ë‚˜ìœ ìŠ¤í¬ë¦½íŠ¸]
    end

    subgraph ContentDB["ğŸ“š ì½˜í…ì¸  DB"]
        PastScripts[(ê³¼ê±° ìŠ¤í¬ë¦½íŠ¸)]

        subgraph Indexing["ì¸ë±ì‹±"]
            Chunker[ì²­í‚¹<br/>Hook/Body/Conclusion]
            CharacterAnalyzer[íŠ¹ì„± ë¶„ì„<br/>ì˜ê²¬/ì˜ˆì‹œ/ë¹„ìœ ]
            Embedder[ì„ë² ë”©<br/>BGE-M3]
        end

        VectorDB[(ë²¡í„° DB<br/>Chroma/Pinecone)]
        KeywordIndex[(í‚¤ì›Œë“œ ì¸ë±ìŠ¤<br/>BM25)]

        PastScripts --> Chunker --> CharacterAnalyzer --> Embedder --> VectorDB
        PastScripts --> KeywordIndex
    end

    subgraph Retrieval["ğŸ” ê²€ìƒ‰"]
        subgraph QueryProcess["ì¿¼ë¦¬ ì²˜ë¦¬"]
            QueryExpand[ì¿¼ë¦¬ í™•ì¥<br/>LLM ìƒì„±]
            QueryEmbed[ì¿¼ë¦¬ ì„ë² ë”©]
        end

        subgraph HybridSearch["í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰"]
            SemanticSearch[ì‹œë§¨í‹± ê²€ìƒ‰<br/>ë²¡í„° ìœ ì‚¬ë„]
            BM25Search[í‚¤ì›Œë“œ ê²€ìƒ‰<br/>BM25]
            Merge[ê²°ê³¼ ë³‘í•©<br/>70:30 ê°€ì¤‘ì¹˜]
        end

        subgraph PostRetrieval["í›„ì²˜ë¦¬"]
            Reranker[ë¦¬ë­ì»¤<br/>BGE-Reranker]
            MMR[ë‹¤ì–‘ì„± ë³´ì¥<br/>MMR Î»=0.7]
        end

        Topic --> QueryExpand --> QueryEmbed
        QueryEmbed --> SemanticSearch
        QueryExpand --> BM25Search

        VectorDB --> SemanticSearch
        KeywordIndex --> BM25Search

        SemanticSearch --> Merge
        BM25Search --> Merge
        Merge --> Reranker --> MMR
    end

    subgraph SpecializedRetrieval["ğŸ¯ íŠ¹í™” ê²€ìƒ‰"]
        SimilarSearch[ìœ ì‚¬ ì£¼ì œ<br/>ì¼ë°˜ ê²€ìƒ‰]
        OpinionSearch[ì˜ê²¬ ê²€ìƒ‰<br/>ê³¼ê±° ê´€ì ]
        ExampleSearch[ì˜ˆì‹œ ê²€ìƒ‰<br/>ë¹„ìœ /ì‚¬ë¡€]
        HookSearch[í›… ê²€ìƒ‰<br/>ì¢‹ì€ ë„ì…ë¶€]

        MMR --> SimilarSearch
        MMR --> OpinionSearch
        MMR --> ExampleSearch
        MMR --> HookSearch
    end

    subgraph ContextBuild["ğŸ—ï¸ ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±"]
        ContextBuilder[ì»¨í…ìŠ¤íŠ¸ ë¹Œë”]

        SimilarSearch --> ContextBuilder
        OpinionSearch --> ContextBuilder
        ExampleSearch --> ContextBuilder
        HookSearch --> ContextBuilder

        PersonaConfig --> ContextBuilder
        Topic --> ContextBuilder
    end

    subgraph Generation["âœ¨ ìƒì„±"]
        PromptBuilder[í”„ë¡¬í”„íŠ¸ ë¹Œë”<br/>í˜ë¥´ì†Œë‚˜ + ì»¨í…ìŠ¤íŠ¸ + ì£¼ì œ]
        LLM[LLM<br/>Claude 3.5 Sonnet]

        subgraph PostProcess["í›„ì²˜ë¦¬"]
            AvoidWordCheck[ê¸ˆì§€ì–´ ì²´í¬]
            AvoidWordReplace[ê¸ˆì§€ì–´ ëŒ€ì²´]
            StyleCheck[ìŠ¤íƒ€ì¼ ì ìˆ˜]
            HookEval[í›… í‰ê°€]
            LengthAdjust[ê¸¸ì´ ì¡°ì •]
        end

        ContextBuilder --> PromptBuilder --> LLM --> AvoidWordCheck
        AvoidWordCheck --> AvoidWordReplace --> StyleCheck --> HookEval --> LengthAdjust
    end

    subgraph QualityGate["âœ… í’ˆì§ˆ ê²Œì´íŠ¸"]
        QualityCheck{í’ˆì§ˆ í†µê³¼?}
        Regenerate[ì¬ìƒì„±<br/>ìµœëŒ€ 2íšŒ]

        LengthAdjust --> QualityCheck
        QualityCheck -->|No| Regenerate --> PromptBuilder
    end

    subgraph Output["ğŸ“¤ ì¶œë ¥"]
        GeneratedScript[(ìƒì„±ëœ ìŠ¤í¬ë¦½íŠ¸)]

        QualityCheck -->|Yes| GeneratedScript
    end

    subgraph FeedbackLoop["ğŸ“Š í”¼ë“œë°± ë£¨í”„"]
        Performance[ì„±ê³¼ ìˆ˜ì§‘]
        HighPerformer{ê³ ì„±ê³¼?}
        FTDataset[(íŒŒì¸íŠœë‹ ë°ì´í„°)]

        GeneratedScript -->|ë°œí–‰ í›„| Performance
        Performance --> HighPerformer
        HighPerformer -->|Yes| FTDataset
        FTDataset -->|í•™ìŠµ| LLM

        Performance -->|ì½˜í…ì¸  ì €ì¥| PastScripts
    end

    %% ìŠ¤íƒ€ì¼
    classDef config fill:#e8eaf6,stroke:#3f51b5
    classDef storage fill:#e3f2fd,stroke:#1565c0
    classDef search fill:#fff3e0,stroke:#ef6c00
    classDef generate fill:#f3e5f5,stroke:#7b1fa2
    classDef quality fill:#c8e6c9,stroke:#388e3c

    class Identity,Voice,Communication,Perspective,Examples config
    class PastScripts,VectorDB,KeywordIndex,FTDataset storage
    class SemanticSearch,BM25Search,Reranker,MMR search
    class LLM,PromptBuilder generate
    class QualityCheck,StyleCheck quality
